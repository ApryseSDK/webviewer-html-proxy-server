const t=t=>!t||t.getBoundingClientRect&&(0===t.getBoundingClientRect().width||0===t.getBoundingClientRect().height);window.addEventListener("message",(e=>{if("${CORS_OPTIONS.origin}"==e.origin&&"loadTextData"==e.data){console.log("message loadTextData",e.origin);const n=(e=>{const n=(e,o,s,i,h)=>{const l=document.createRange();return e.childNodes.forEach((e=>{if(!t(e))if(e.nodeType===Node.TEXT_NODE){const t=e.textContent,n=t.length,c=Array.from(t).filter((t=>!("\\n"===t||" "===t||"\\t"===t))).length>0;if(0===n||!c)return;const g=[],r=i.length/8,u=[];let d=!1,a=0;for(let o=0;o<n;o++){l.setStart(e,o),l.setEnd(e,o+1);const{bottom:n,top:i,left:c,right:r}=l.getBoundingClientRect();g.push(c,n,r,n,r,i,c,i);const f=t[o];if(" "===f?s.push(-1):"\\n"===f?s.push(-2):s.push(2*s.length)," "===f||"\\n"===f){d=!1,h+=f;continue}const p=o+a;if(0===u.length||Math.abs(g[8*(p-1)+1]-g[8*p+1])>.1){if(0!==u.length){const e=t[o-1];" "!==e&&"\\n"!==e&&(h+="\\n",g.push(...g.slice(-8)),s.push(s[s.length-1]),s[s.length-2]=-2,a++)}u.push([[o+a]]),d=!0}else{const t=u[u.length-1];d?t[t.length-1].push(p):(t.push([p]),d=!0)}h+=f}i.push(...g);const f=t[n-1];" "!==f&&"\\n"!==f&&(h+="\\n",i.push(...i.slice(-8)),s.push(-2));const p=u.length;o[0]+=p;for(let t=0;t<p;t++){const e=u[t],n=e[0],s=e[e.length-1],i=n[0],h=s[s.length-1];o.push(e.length,0,g[8*i],g[8*i+1],g[8*h+4],g[8*h+5]);for(let t=0;t<e.length;t++){const n=e[t],s=n.length,i=n[0],h=n[s-1];o.push(s,i+r,s,g[8*i],g[8*h+2])}}}else{if(e.nodeType==Node.ELEMENT_NODE){const t=window.getComputedStyle(e);if("none"==t.display||"hidden"==t.visibility||0==t.opacity)return}h=n(e,o,s,i,h)}})),h};return(t=>{const e=[0],o=[],s=[];return{struct:e,str:n(t,e,o,s,""),offsets:o,quads:s}})(e)})(document.body),o=(e=>{const n=(e,o)=>(e.childNodes.forEach((e=>{if(!t(e))if("A"===e.tagName&&e.href){const t=e.getBoundingClientRect();o.push({clientRect:t,href:e.getAttribute("href")})}else n(e,o)})),o);return n(e,[])})(document.body);window.parent.postMessage({selectionData:n,linkData:o},"${CORS_OPTIONS.origin}")}}));